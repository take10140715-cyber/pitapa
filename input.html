<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>定期区間申請フォーム</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #f8fafc; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // --- 駅データ (PiTaPa Checker v54と同一データ) ---
        const STATION_DATA = {
            "JR西日本": {
                "京都線・神戸線・琵琶湖線": ["米原", "彦根", "南彦根", "河瀬", "稲枝", "能登川", "安土", "近江八幡", "篠原", "野洲", "守山", "栗東", "草津", "南草津", "瀬田", "石山", "膳所", "大津", "山科", "京都", "西大路", "桂川", "向日町", "長岡京", "山崎", "島本", "高槻", "摂津富田", "ＪＲ総持寺", "茨木", "千里丘", "岸辺", "吹田", "東淀川", "新大阪", "大阪", "塚本", "尼崎", "立花", "甲子園口", "西宮", "さくら夙川", "芦屋", "甲南山手", "摂津本山", "住吉", "六甲道", "摩耶", "灘", "三ノ宮", "元町", "神戸", "兵庫", "新長田", "鷹取", "須磨海浜公園", "須磨", "塩屋", "垂水", "舞子", "朝霧", "明石", "西明石", "大久保", "魚住", "土山", "東加古川", "加古川", "宝殿", "曽根", "ひめじ別所", "御着", "東姫路", "姫路"],
                "山陽本線(姫路-相生)": ["姫路", "英賀保", "はりま勝原", "網干", "竜野", "相生"],
                "宝塚線(福知山線)": ["尼崎", "塚口", "猪名寺", "伊丹", "北伊丹", "川西池田", "中山寺", "宝塚", "生瀬", "西宮名塩", "武田尾", "道場", "三田", "新三田"],
                "東西線・学研都市線": ["木津", "西木津", "祝園", "下狛", "ＪＲ三山木", "同志社前", "京田辺", "大住", "松井山手", "長尾", "藤阪", "津田", "河内磐船", "星田", "寝屋川公園", "忍ヶ丘", "四条畷", "野崎", "住道", "鴻池新田", "徳庵", "放出", "鴫野", "京橋", "大阪城北詰", "大阪天満宮", "北新地", "新福島", "海老江", "御幣島", "加島", "尼崎"],
                "大阪環状線": ["大阪", "福島", "野田", "西九条", "弁天町", "大正", "芦原橋", "今宮", "新今宮", "天王寺", "寺田町", "桃谷", "鶴橋", "玉造", "森ノ宮", "大阪城公園", "京橋", "桜ノ宮", "天満", "大阪"],
                "阪和線": ["天王寺", "美章園", "南田辺", "鶴ヶ丘", "長居", "我孫子町", "杉本町", "浅香", "堺市", "三国ヶ丘", "百舌鳥", "上野芝", "津久野", "鳳", "富木", "北信太", "信太山", "和泉府中", "久米田", "下松", "東岸和田", "東貝塚", "和泉橋本", "東佐野", "熊取", "日根野", "りんくうタウン", "関西空港"],
                "大和路線": ["加茂", "木津", "平城山", "奈良", "郡山", "大和小泉", "法隆寺", "王寺", "三郷", "河内堅上", "高井田", "柏原", "志紀", "八尾", "久宝寺", "加美", "平野", "東部市場前", "天王寺", "新今宮", "今宮", "ＪＲ難波"],
                "赤穂線": ["相生", "西相生", "坂越", "播州赤穂", "天和", "備前福河", "日生", "寒河", "邑久", "長船", "香登", "伊部", "西片上", "西大寺", "大富", "東岡山"],
                "湖西線": ["京都", "山科", "大津京", "唐崎", "比叡山坂本", "おごと温泉", "堅田", "小野", "和邇", "蓬莱", "志賀", "比良", "近江舞子", "北小松", "近江高島", "安曇川", "新旭", "近江今津", "近江中庄", "マキノ", "永原"],
                "草津線": ["草津", "手原", "石部", "甲西", "三雲", "貴生川", "甲南", "寺庄", "甲賀", "油日", "柘植"],
                "奈良線": ["京都", "東福寺", "稲荷", "ＪＲ藤森", "桃山", "六地蔵", "木幡", "黄檗", "宇治", "ＪＲ小倉", "新田", "城陽", "長池", "山城青谷", "山城多賀", "玉水", "棚倉", "上狛", "木津", "奈良"],
                "嵯峨野線(山陰本線)": ["京都", "梅小路京都西", "丹波口", "二条", "円町", "花園", "太秦", "嵯峨嵐山", "保津峡", "馬堀", "亀岡", "並河", "千代川", "八木", "吉富", "園部"],
                "おおさか東線": ["大阪", "新大阪", "南吹田", "ＪＲ淡路", "城北公園通", "ＪＲ野江", "鴫野", "放出", "高井田中央", "ＪＲ河内永和", "ＪＲ俊徳道", "ＪＲ長瀬", "衣摺加美北", "新加美", "久宝寺"],
                "関西空港線": ["日根野", "りんくうタウン", "関西空港"],
                "和歌山線": ["王寺", "畠田", "志都美", "香芝", "ＪＲ五位堂", "高田", "大和新庄", "御所", "玉手", "掖上", "吉野口", "北宇智", "五条", "大和二見", "隅田", "下兵庫", "橋本", "紀伊山田", "高野口", "中飯降", "妙寺", "大谷", "笠田", "西笠田", "名手", "粉河", "紀伊長田", "打田", "下井阪", "岩出", "船戸", "紀伊小倉", "布施屋", "千旦", "田井ノ瀬", "和歌山"],
                "万葉まほろば線(桜井線)": ["奈良", "京終", "帯解", "山城", "櫟本", "天理", "長柄", "柳本", "巻向", "三輪", "桜井", "香久山", "畝傍", "金橋", "高田"]
            },
            "大阪メトロ": {
                "御堂筋線": ["江坂", "東三国", "新大阪", "西中島南方", "中津", "梅田", "淀屋橋", "本町", "心斎橋", "なんば", "大国町", "動物園前", "天王寺", "昭和町", "西田辺", "長居", "あびこ", "北花田", "新金岡", "なかもず"],
                "谷町線": ["大日", "守口", "太子橋今市", "千林大宮", "関目高殿", "野江内代", "都島", "天神橋筋六丁目", "中崎町", "東梅田", "南森町", "天満橋", "谷町四丁目", "谷町六丁目", "谷町九丁目", "四天王寺前夕陽ヶ丘", "天王寺", "阿倍野", "文の里", "田辺", "駒川中野", "平野", "喜連瓜破", "出戸", "長原", "八尾南"],
                "四つ橋線": ["西梅田", "肥後橋", "本町", "四ツ橋", "なんば", "大国町", "花園町", "岸里", "玉出", "北加賀屋", "住之江公園"],
                "中央線": ["コスモスクエア", "大阪港", "朝潮橋", "弁天町", "九条", "阿波座", "本町", "堺筋本町", "谷町四丁目", "森ノ宮", "緑橋", "深江橋", "高井田", "長田"],
                "夢洲線": ["コスモスクエア", "夢洲"],
                "千日前線": ["野田阪神", "玉川", "阿波座", "西長堀", "桜川", "なんば", "日本橋", "谷町九丁目", "鶴橋", "今里", "新深江", "小路", "北巽", "南巽"],
                "堺筋線": ["天神橋筋六丁目", "扇町", "南森町", "北浜", "堺筋本町", "長堀橋", "日本橋", "恵美須町", "動物園前", "天下茶屋"],
                "長堀鶴見緑地線": ["大正", "ドーム前千代崎", "西長堀", "西大橋", "心斎橋", "長堀橋", "松屋町", "谷町六丁目", "玉造", "森ノ宮", "大阪ビジネスパーク", "京橋", "蒲生四丁目", "今福鶴見", "横堤", "鶴見緑地", "門真南"],
                "今里筋線": ["井高野", "瑞光四丁目", "だいどう豊里", "太子橋今市", "清水", "新森古市", "関目成育", "蒲生四丁目", "鴫野", "緑橋", "今里"],
                "南港ポートタウン線(ニュートラム)": ["コスモスクエア", "トレードセンター前", "中ふ頭", "ポートタウン西", "ポートタウン東", "フェリーターミナル", "南港東", "南港口", "平林", "住之江公園"]
            },
            "北大阪急行": {
                "南北線": ["箕面萱野", "箕面船場阪大前", "千里中央", "桃山台", "緑地公園", "江坂"]
            },
            "大阪モノレール": {
                "本線": ["大阪空港", "蛍池", "柴原阪大前", "少路", "千里中央", "山田", "万博記念公園", "宇野辺", "南茨木", "沢良宜", "摂津", "南摂津", "大日", "門真市"],
                "彩都線": ["万博記念公園", "公園東口", "阪大病院前", "豊川", "彩都西"]
            },
            "山陽電車": {
                "本線": ["西代", "板宿", "東須磨", "月見山", "須磨寺", "山陽須磨", "須磨浦公園", "山陽塩屋", "滝の茶屋", "東垂水", "山陽垂水", "霞ヶ丘", "舞子公園", "西舞子", "大蔵谷", "人丸前", "山陽明石", "西新町", "林崎松江海岸", "藤江", "中八木", "江井ヶ島", "西江井ヶ島", "山陽魚住", "東二見", "西二見", "播磨町", "別府", "浜の宮", "尾上の松", "高砂", "荒井", "伊保", "山陽曽根", "大塩", "的形", "八家", "白浜の宮", "妻鹿", "飾磨", "亀山", "手柄", "山陽姫路"],
                "網干線": ["飾磨", "西飾磨", "夢前川", "広畑", "山陽天満", "平松", "山陽網干"]
            },
            "阪急電鉄": {
                "京都線": ["京都河原町", "烏丸", "大宮", "西院", "西京極", "桂", "洛西口", "東向日", "西向日", "長岡天神", "西山天王山", "大山崎", "水無瀬", "上牧", "高槻市", "富田", "総持寺", "茨木市", "南茨木", "摂津市", "正雀", "相川", "上新庄", "淡路", "崇禅寺", "南方", "十三", "大阪梅田"],
                "宝塚線": ["宝塚", "清荒神", "売布神社", "中山観音", "山本", "雲雀丘花屋敷", "川西能勢口", "池田", "石橋阪大前", "蛍池", "豊中", "岡町", "曽根", "服部天神", "庄内", "三国", "十三", "中津", "大阪梅田"],
                "神戸線": ["神戸三宮", "春日野道", "王子公園", "六甲", "御影", "岡本", "芦屋川", "夙川", "西宮北口", "武庫之荘", "塚口", "園田", "神崎川", "十三", "中津", "大阪梅田"],
                "千里線": ["北千里", "山田", "南千里", "千里山", "関大前", "豊津", "吹田", "下新庄", "淡路", "柴島", "天神橋筋六丁目"],
                "嵐山線": ["桂", "上桂", "松尾大社", "嵐山"],
                "今津線": ["宝塚", "宝塚南口", "逆瀬川", "小林", "仁川", "甲東園", "門戸厄神", "西宮北口", "阪神国道", "今津"],
                "箕面線": ["石橋阪大前", "桜井", "牧落", "箕面"],
                "伊丹線": ["塚口", "稲野", "新伊丹", "伊丹"],
                "甲陽線": ["夙川", "苦楽園口", "甲陽園"]
            },
            "阪神電車": {
                "本線": ["元町", "神戸三宮", "春日野道", "岩屋", "西灘", "大石", "新在家", "石屋川", "御影", "住吉", "魚崎", "青木", "深江", "芦屋", "打出", "香櫨園", "西宮", "今津", "久寿川", "甲子園", "鳴尾・武庫川女子大前", "武庫川", "尼崎センタープール前", "出屋敷", "尼崎", "大物", "杭瀬", "千船", "姫島", "淀川", "野田", "福島", "大阪梅田"],
                "なんば線": ["大阪難波", "桜川", "ドーム前", "九条", "西九条", "千鳥橋", "伝法", "福", "出来島", "大物", "尼崎"]
            },
            "神戸高速鉄道": {
                "東西線(阪神・山陽)": ["西代", "高速長田", "大開", "新開地", "高速神戸", "西元町", "元町"],
                "東西線(阪急)": ["新開地", "高速神戸", "花隈", "神戸三宮"],
                "南北線": ["湊川", "新開地"]
            },
            "京阪電車": {
                "本線": ["淀屋橋", "北浜", "天満橋", "京橋", "野江", "関目", "森小路", "千林", "滝井", "土居", "守口市", "西三荘", "門真市", "古川橋", "大和田", "萱島", "寝屋川市", "香里園", "光善寺", "枚方公園", "枚方市", "御殿山", "牧野", "樟葉", "橋本", "石清水八幡宮", "淀", "中書島", "伏見桃山", "丹波橋", "墨染", "藤森", "龍谷大前深草", "伏見稲荷", "鳥羽街道", "東福寺", "七条", "清水五条", "祇園四条", "三条", "神宮丸太町", "出町柳"],
                "鴨東線": ["三条", "神宮丸太町", "出町柳"],
                "中之島線": ["中之島", "渡辺橋", "大江橋", "なにわ橋", "天満橋"],
                "交野線": ["枚方市", "宮之阪", "星ヶ丘", "村野", "郡津", "交野市", "河内森", "私市"],
                "宇治線": ["中書島", "観月橋", "桃山南口", "六地蔵", "木幡", "黄檗", "三室戸", "宇治"],
                "京津線": ["御陵", "京阪山科", "四宮", "追分", "大谷", "上栄町", "びわ湖浜大津"],
                "石山坂本線": ["石山寺", "唐橋前", "京阪石山", "粟津", "瓦ヶ浜", "中ノ庄", "膳所本町", "錦", "京阪膳所", "石場", "島ノ関", "びわ湖浜大津", "三井寺", "大津市役所前", "京阪大津京", "近江神宮前", "南滋賀", "滋賀里", "穴太", "松ノ馬場", "坂本比叡山口"]
            },
            "近鉄電車": {
                "奈良線": ["大阪難波", "近鉄日本橋", "大阪上本町", "鶴橋", "今里", "布施", "河内永和", "河内小阪", "八戸ノ里", "若江岩田", "河内花園", "東花園", "瓢箪山", "枚岡", "額田", "石切", "生駒", "東生駒", "富雄", "学園前", "菖蒲池", "大和西大寺", "新大宮", "近鉄奈良"],
                "大阪線": ["大阪上本町", "鶴橋", "今里", "布施", "俊徳道", "長瀬", "弥刀", "久宝寺口", "近鉄八尾", "河内山本", "高安", "恩智", "法善寺", "堅下", "安堂", "河内国分", "大阪教育大前", "関屋", "二上", "近鉄下田", "五位堂", "築山", "大和高田", "松塚", "真菅", "大和八木", "耳成", "大福", "桜井", "大和朝倉", "長谷寺", "榛原", "室生口大野", "三本松", "赤目口", "名張", "伊賀神戸", "青山町", "伊賀上津", "西青山", "東青山", "榊原温泉口", "大三", "伊勢石橋", "川合高岡", "伊勢中川"],
                "京都線": ["京都", "東寺", "十条", "上鳥羽口", "竹田", "伏見", "近鉄丹波橋", "桃山御陵前", "向島", "小倉", "伊勢田", "大久保", "久津川", "寺田", "富野荘", "新田辺", "興戸", "三山木", "近鉄宮津", "狛田", "新祝園", "木津川台", "山田川", "高の原", "平城", "大和西大寺"],
                "南大阪線": ["大阪阿部野橋", "河堀口", "北田辺", "今川", "針中野", "矢田", "河内天美", "布忍", "高見ノ里", "河内松原", "恵我ノ荘", "高鷲", "藤井寺", "土師ノ里", "道明寺", "古市", "駒ヶ谷", "上ノ太子", "二上山", "二上神社口", "当麻寺", "磐城", "尺土", "高田市", "浮孔", "坊城", "橿原神宮前"],
                "吉野線": ["橿原神宮前", "岡寺", "飛鳥", "壺阪山", "市尾", "葛", "吉野口", "薬水", "福神", "大阿太", "下市口", "越部", "六田", "大和上市", "吉野神宮", "吉野"],
                "橿原線": ["大和西大寺", "尼ヶ辻", "西ノ京", "九条", "近鉄郡山", "筒井", "平端", "ファミリー公園前", "結崎", "石見", "田原本", "笠縫", "新ノ口", "大和八木", "八木西口", "畝傍御陵前", "橿原神宮前"],
                "天理線": ["平端", "二階堂", "前栽", "天理"],
                "田原本線": ["新王寺", "大輪田", "佐味田川", "池部", "箸尾", "但馬", "黒田", "西田原本"],
                "生駒線": ["王寺", "信貴山下", "勢野北口", "竜田川", "白庭台", "学研北生駒", "富雄", "東山", "元山上口", "平群", "菜畑", "一分", "南生駒", "萩の台", "生駒"],
                "けいはんな線": ["長田", "荒本", "吉田", "新石切", "生駒", "白庭台", "学研北生駒", "学研奈良登美ヶ丘"],
                "信貴線": ["河内山本", "服部川", "信貴山口"],
                "道明寺線": ["道明寺", "柏原南口", "柏原"],
                "長野線": ["古市", "喜志", "富田林", "富田林西口", "川西", "滝谷不動", "汐ノ宮", "河内長野"],
                "御所線": ["尺土", "近鉄新庄", "忍海", "近鉄御所"]
            },
            "南海電鉄": {
                "本線": ["難波", "新今宮", "天下茶屋", "岸里玉出", "粉浜", "住吉大社", "住ノ江", "七道", "堺", "湊", "石津川", "諏訪ノ森", "浜寺公園", "羽衣", "高石", "北助松", "松ノ浜", "泉大津", "忠岡", "春木", "和泉大宮", "岸和田", "蛸地蔵", "貝塚", "二色浜", "鶴原", "井原里", "泉佐野", "羽倉崎", "吉見ノ里", "岡田浦", "樽井", "尾崎", "鳥取ノ荘", "箱作", "淡輪", "みさき公園", "孝子", "和歌山大学前", "紀ノ川", "和歌山市"],
                "高野線": ["難波", "新今宮", "天下茶屋", "岸里玉出", "帝塚山", "住吉東", "沢ノ町", "我孫子前", "浅香山", "堺東", "三国ヶ丘", "百舌鳥八幡", "中百舌鳥", "白鷺", "初芝", "萩原天神", "北野田", "狭山", "大阪狭山市", "金剛", "滝谷", "千代田", "河内長野", "三日市町", "美加の台", "千早口", "天見", "紀見峠", "林間田園都市", "御幸辻", "橋本", "紀伊清水", "学文路", "九度山", "高野下", "下古沢", "上古沢", "紀伊細川", "紀伊神谷", "極楽橋", "高野山"],
                "空港線": ["泉佐野", "りんくうタウン", "関西空港"],
                "多奈川線": ["みさき公園", "深日町", "深日港", "多奈川"],
                "加太線": ["紀ノ川", "東松江", "中松江", "八幡前", "西ノ庄", "二里ヶ浜", "磯ノ浦", "加太"],
                "和歌山港線": ["和歌山市", "和歌山港"],
                "高師浜線": ["羽衣", "伽羅橋", "高師浜"],
                "汐見橋線": ["岸里玉出", "西天下茶屋", "津守", "木津川", "芦原町", "汐見橋"]
            },
            "京都市営地下鉄": {
                "烏丸線": ["国際会館", "松ヶ崎", "北山", "北大路", "鞍馬口", "今出川", "丸太町", "烏丸御池", "四条", "五条", "京都", "九条", "十条", "くいな橋", "竹田"],
                "東西線": ["六地蔵", "石田", "醍醐", "小野", "椥辻", "東野", "山科", "御陵", "蹴上", "東山", "三条京阪", "京都市役所前", "烏丸御池", "二条城前", "二条", "西大路御池", "太秦天神川"]
            },
            "神戸市営地下鉄": {
                "西神・山手線": ["谷上", "新神戸", "三宮", "県庁前", "大倉山", "湊川公園", "上沢", "長田", "新長田", "板宿", "妙法寺", "名谷", "総合運動公園", "学園都市", "伊川谷", "西神南", "西神中央"],
                "海岸線": ["三宮・花時計前", "旧居留地・大丸前", "みなと元町", "ハーバーランド", "中央市場前", "和田岬", "御崎公園", "苅藻", "駒ヶ林", "新長田"]
            },
            "京福電気鉄道": {
                "嵐山本線": ["四条大宮", "西院", "西大路三条", "山ノ内", "嵐電天神川", "蚕ノ社", "太秦広隆寺", "帷子ノ辻", "有栖川", "車折神社", "鹿王院", "嵐電嵯峨", "嵐山"],
                "北野線": ["北野白梅町", "等持院・立命館大学衣笠キャンパス前", "龍安寺", "妙心寺", "御室仁和寺", "宇多野", "鳴滝", "常盤", "撮影所前", "帷子ノ辻"]
            },
            "叡山電鉄": {
                "叡山本線": ["出町柳", "元田中", "茶山・京都芸術大学", "一乗寺", "修学院", "宝ヶ池", "三宅八幡", "八瀬比叡山口"],
                "鞍馬線": ["宝ヶ池", "八幡前", "岩倉", "木野", "京都精華大前", "二軒茶屋", "市原", "二ノ瀬", "貴船口", "鞍馬"]
            },
            "神戸電鉄": {
                "有馬線": ["湊川", "長田", "丸山", "鵯越", "鈴蘭台", "北鈴蘭台", "山の街", "箕谷", "谷上", "花山", "大池", "神鉄六甲", "唐櫃台", "有馬口", "有馬温泉"],
                "三田線": ["有馬口", "五社", "岡場", "田尾寺", "二郎", "道場南口", "神鉄道場", "横山", "三田本町", "三田"],
                "公園都市線": ["横山", "フラワータウン", "南ウッディタウン", "ウッディタウン中央"],
                "粟生線": ["鈴蘭台", "鈴蘭台西口", "西鈴蘭台", "藍那", "木津", "木幡", "栄", "押部谷", "緑が丘", "広野ゴルフ場前", "志染", "恵比須", "三木上の丸", "三木", "大村", "樫山", "市場", "小野", "葉多", "粟生"],
                "神戸高速線": ["新開地", "湊川"]
            },
            "能勢電鉄": {
                "妙見線": ["川西能勢口", "絹延橋", "滝山", "鶯の森", "鼓滝", "多田", "平野", "一の鳥居", "畦野", "山下", "笹部", "光風台", "ときわ台", "妙見口"],
                "日生線": ["山下", "日生中央"]
            },
            "泉北高速鉄道": {
                "泉北高速鉄道線": ["中百舌鳥", "深井", "泉ケ丘", "栂・美木多", "光明池", "和泉中央"]
            },
            "水間鉄道": {
                "水間線": ["貝塚", "貝塚市役所前", "近義の里", "石才", "清児", "名越", "森", "三ツ松", "三ヶ山口", "水間観音"]
            },
            "神戸新交通": {
                "ポートアイランド線": ["三宮", "貿易センター", "ポートターミナル", "中公園", "みなとじま", "市民広場", "医療センター", "計算科学センター", "神戸空港", "南公園", "中埠頭", "北埠頭"],
                "六甲アイランド線": ["住吉", "魚崎", "南魚崎", "アイランド北口", "アイランドセンター", "マリンパーク"]
            }
        };

        const StationSelector = ({ label, type, value, onChange }) => {
            const lines = useMemo(() => {
                if (STATION_DATA[value.company]) return Object.keys(STATION_DATA[value.company]);
                return [];
            }, [value.company]);

            const stations = useMemo(() => {
                if (STATION_DATA[value.company] && STATION_DATA[value.company][value.line]) {
                    return STATION_DATA[value.company][value.line];
                }
                return [];
            }, [value.company, value.line]);

            return (
                <div className="bg-white p-4 rounded-lg border border-gray-200">
                    <span className="block text-sm font-bold text-gray-700 mb-2 border-b pb-1">{label}</span>
                    <div className="space-y-3">
                        <div>
                            <label className="block text-xs text-gray-500 mb-1">事業者</label>
                            <select 
                                className="w-full border p-2 rounded text-sm bg-gray-50 focus:ring-2 focus:ring-blue-200 outline-none"
                                value={value.company}
                                onChange={(e) => onChange({ ...value, company: e.target.value, line: "", station: "" })}
                            >
                                {Object.keys(STATION_DATA).map(c => <option key={c} value={c}>{c}</option>)}
                                <option value="その他">その他</option>
                            </select>
                        </div>
                        <div>
                            <label className="block text-xs text-gray-500 mb-1">路線</label>
                            {lines.length > 0 ? (
                                <select 
                                    className="w-full border p-2 rounded text-sm bg-gray-50 focus:ring-2 focus:ring-blue-200 outline-none"
                                    value={value.line}
                                    onChange={(e) => onChange({ ...value, line: e.target.value, station: "" })}
                                >
                                    <option value="">路線を選択...</option>
                                    {lines.map(l => <option key={l} value={l}>{l}</option>)}
                                </select>
                            ) : (
                                <input 
                                    className="w-full border p-2 rounded text-sm bg-gray-50 focus:ring-2 focus:ring-blue-200 outline-none"
                                    placeholder="路線名を入力"
                                    value={value.line}
                                    onChange={(e) => onChange({ ...value, line: e.target.value })}
                                />
                            )}
                        </div>
                        <div>
                            <label className="block text-xs text-gray-500 mb-1">駅名</label>
                            <input 
                                list={`station-list-${type}`}
                                className="w-full border p-2 rounded text-sm bg-gray-50 focus:ring-2 focus:ring-blue-200 outline-none"
                                placeholder="駅名を入力"
                                value={value.station}
                                onChange={(e) => onChange({ ...value, station: e.target.value })}
                            />
                            <datalist id={`station-list-${type}`}>
                                {stations.map(s => <option key={s} value={s} />)}
                            </datalist>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [name, setName] = useState("");
            const [routes, setRoutes] = useState([]);
            
            // 現在入力中のルート状態
            const [currentRoute, setCurrentRoute] = useState({
                from: { company: "JR西日本", line: "", station: "" },
                to: { company: "JR西日本", line: "", station: "" }
            });

            // バリデーション
            const isNameValid = name.trim().includes("　"); // 全角スペースチェック
            const canAddRoute = currentRoute.from.station && currentRoute.to.station;

            const handleNameChange = (e) => setName(e.target.value);

            // 発駅側を変更したとき、着駅側の事業者・路線も同期させる（利便性のため）
            const handleFromChange = (newVal) => {
                setCurrentRoute(prev => {
                    const toUpdate = { ...prev.to };
                    
                    // 事業者が同じなら同期
                    if (prev.from.company === prev.to.company) {
                        toUpdate.company = newVal.company;
                        
                        // さらに路線も同じなら同期
                        if (prev.from.line === prev.to.line) {
                            toUpdate.line = newVal.line;
                            
                            // 路線が変わった場合、着駅の駅名はクリアする（前の路線の駅名が残らないように）
                            if (prev.to.line !== newVal.line) {
                                toUpdate.station = "";
                            }
                        }
                    }

                    return {
                        ...prev,
                        from: newVal,
                        to: toUpdate
                    };
                });
            };

            const handleToChange = (newVal) => {
                setCurrentRoute(prev => ({ ...prev, to: newVal }));
            };

            const addRoute = () => {
                if (!canAddRoute) return;
                setRoutes([...routes, { ...currentRoute }]);
                // リセット（事業者はそのまま維持）
                setCurrentRoute(prev => ({
                    from: { ...prev.from, line: "", station: "" },
                    to: { ...prev.to, line: "", station: "" }
                }));
            };

            const removeRoute = (index) => {
                setRoutes(routes.filter((_, i) => i !== index));
            };

            const generateCSV = () => {
                if (!isNameValid) {
                    alert("氏名の姓と名の間に全角スペースを入れてください。");
                    return;
                }
                if (routes.length === 0) {
                    alert("定期区間が登録されていません。");
                    return;
                }

                // Header (PiTaPa Checker v51+ 互換)
                let csvContent = "\uFEFF# === ユーザー定期設定 ===\n# Type, Name, FromCompany, FromLine, FromStation, ToCompany, ToLine, ToStation\n";
                
                routes.forEach(r => {
                    const row = [
                        "USER",
                        name,
                        r.from.company,
                        r.from.line,
                        r.from.station,
                        r.to.company,
                        r.to.line,
                        r.to.station
                    ].map(field => {
                        // カンマを含む場合はダブルクォートで囲む（念のため）
                        return String(field).includes(",") ? `"${field}"` : field;
                    }).join(",");
                    csvContent += row + "\n";
                });

                // ファイル名生成 (スペースなしフルネーム + 日付)
                const cleanName = name.replace(/[\s　]+/g, "");
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                const fileName = `${cleanName}_${yyyy}${mm}${dd}.csv`;

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            return (
                <div className="min-h-screen p-4 md:p-8 max-w-3xl mx-auto">
                    <header className="mb-8 text-center animate-fade-in">
                        <h1 className="text-2xl md:text-3xl font-bold text-slate-800 mb-2">定期区間申請フォーム</h1>
                        <p className="text-sm text-gray-500">PiTaPa利用チェック用の定期区間登録データを作成します。</p>
                    </header>

                    <div className="bg-white p-6 md:p-8 rounded-xl shadow-lg space-y-8 animate-fade-in border border-slate-100">
                        
                        {/* 1. 氏名入力 */}
                        <section>
                            <h2 className="flex items-center text-lg font-bold text-slate-700 mb-3">
                                <span className="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2">1</span>
                                氏名を入力
                            </h2>
                            <div className="bg-slate-50 p-4 rounded-lg">
                                <label className="block text-sm font-bold text-gray-700 mb-1">氏名 (全角スペース必須)</label>
                                <input 
                                    type="text" 
                                    value={name}
                                    onChange={handleNameChange}
                                    placeholder="例: 山田　太郎"
                                    className={`w-full border p-3 rounded-lg text-lg outline-none transition ${!name ? 'border-gray-300' : isNameValid ? 'border-green-500 ring-1 ring-green-200' : 'border-red-500 ring-1 ring-red-200'}`}
                                />
                                {!isNameValid && name.length > 0 && (
                                    <p className="text-red-500 text-xs mt-1 font-bold">※ 姓と名の間に全角スペースを入れてください</p>
                                )}
                                <p className="text-gray-400 text-xs mt-1">※ PiTaPa利用明細の氏名と完全に一致させる必要があります。</p>
                            </div>
                        </section>

                        {/* 2. 区間入力 */}
                        <section>
                            <h2 className="flex items-center text-lg font-bold text-slate-700 mb-3">
                                <span className="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2">2</span>
                                定期区間を選択
                            </h2>
                            
                            <div className="bg-slate-50 p-4 rounded-lg space-y-4">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <StationSelector 
                                        label="発（乗車駅）" 
                                        type="from" 
                                        value={currentRoute.from} 
                                        onChange={handleFromChange} 
                                    />
                                    <StationSelector 
                                        label="着（降車駅）" 
                                        type="to" 
                                        value={currentRoute.to} 
                                        onChange={handleToChange} 
                                    />
                                </div>
                                
                                <div className="text-center">
                                    <button 
                                        onClick={addRoute}
                                        disabled={!canAddRoute}
                                        className="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold shadow-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition w-full md:w-auto"
                                    >
                                        ↓ 区間リストに追加
                                    </button>
                                </div>
                                <p className="text-center text-xs text-gray-400">※バス路線は登録不要です</p>
                            </div>
                        </section>

                        {/* 3. 確認と出力 */}
                        <section>
                            <h2 className="flex items-center text-lg font-bold text-slate-700 mb-3">
                                <span className="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2">3</span>
                                登録リスト確認・出力
                            </h2>

                            {routes.length > 0 ? (
                                <div className="space-y-4">
                                    <div className="border rounded-lg overflow-hidden">
                                        <table className="w-full text-sm text-left">
                                            <thead className="bg-gray-100 text-gray-600">
                                                <tr>
                                                    <th className="px-4 py-2">発</th>
                                                    <th className="px-4 py-2 text-center">⇔</th>
                                                    <th className="px-4 py-2">着</th>
                                                    <th className="px-4 py-2"></th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y">
                                                {routes.map((r, i) => (
                                                    <tr key={i} className="bg-white">
                                                        <td className="px-4 py-3">
                                                            <div className="font-bold text-blue-800 text-xs">[{r.from.company}]</div>
                                                            <div>{r.from.station}</div>
                                                        </td>
                                                        <td className="px-4 py-3 text-center text-gray-400">⇔</td>
                                                        <td className="px-4 py-3">
                                                            <div className="font-bold text-blue-800 text-xs">[{r.to.company}]</div>
                                                            <div>{r.to.station}</div>
                                                        </td>
                                                        <td className="px-4 py-3 text-right">
                                                            <button 
                                                                onClick={() => removeRoute(i)}
                                                                className="text-red-500 hover:text-red-700 border border-red-200 bg-red-50 px-3 py-1 rounded text-xs"
                                                            >
                                                                削除
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>

                                    <div className="pt-4 border-t">
                                        <button 
                                            onClick={generateCSV}
                                            disabled={!isNameValid}
                                            className="w-full bg-green-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center gap-2"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                            申請用CSVファイルを保存
                                        </button>
                                        {!isNameValid && <p className="text-center text-red-500 font-bold mt-2">※ 氏名の形式が正しくありません</p>}
                                    </div>
                                </div>
                            ) : (
                                <div className="text-center py-10 bg-gray-50 rounded-lg text-gray-400 border-2 border-dashed">
                                    まだ区間が追加されていません
                                </div>
                            )}
                        </section>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
